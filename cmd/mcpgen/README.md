# mcpgen - MCP Schema Generator

`mcpgen` generates `SchemaProvider` implementations for Go types, enabling zero-reflection schema generation at runtime.

## Installation

```bash
go install github.com/modelcontextprotocol/go-sdk/cmd/mcpgen@latest
```

## Usage

Add a `go:generate` directive to your code:

```go
//go:generate mcpgen -type=CreateIssueInput,UpdateIssueInput
```

Then run:

```bash
go generate ./...
```

This generates a `*_mcp_gen.go` file with `SchemaProvider` implementations for the specified types.

## Example

**Input:**

```go
// types.go
package mypackage

//go:generate mcpgen -type=CreateIssueInput

type CreateIssueInput struct {
    Title  string   `json:"title" jsonschema:"required,description=Issue title"`
    Body   string   `json:"body" jsonschema:"description=Issue body"`
    Labels []string `json:"labels"`
}
```

**Generated output:**

```go
// mypackage_mcp_gen.go
// Code generated by mcpgen. DO NOT EDIT.

package mypackage

import (
    "github.com/google/jsonschema-go/jsonschema"
)

var (
    _createissueinputSchema = &jsonschema.Schema{
        Type: "object",
        Properties: map[string]*jsonschema.Schema{
            "title": {
                Type:        "string",
                Description: "Issue title",
            },
            "body": {
                Type:        "string",
                Description: "Issue body",
            },
            "labels": {
                Type: "array",
            },
        },
        Required:             []string{"title"},
        AdditionalProperties: &jsonschema.Schema{Not: &jsonschema.Schema{}},
    }
    _createissueinputResolved, _ = _createissueinputSchema.Resolve(nil)
)

func (CreateIssueInput) MCPSchema() *jsonschema.Schema {
    return _createissueinputSchema
}

func (CreateIssueInput) MCPResolvedSchema() *jsonschema.Resolved {
    return _createissueinputResolved
}
```

## Struct Tags

`mcpgen` recognizes the following struct tags:

### `json` tag

- `json:"fieldname"` - Sets the JSON property name
- `json:"-"` - Excludes the field from the schema

### `jsonschema` tag

- `required` - Marks the field as required
- `description=text` - Sets the field description
- `default=value` - Sets the default value
- `enum=a|b|c` - Sets allowed enum values (pipe-separated)

## Flags

- `-type` - Comma-separated list of type names to generate (required)
- `-output` - Output file name (default: `<package>_mcp_gen.go`)

## Benefits

Using generated schemas provides:

1. **Zero runtime reflection** - Schemas are pre-computed at build time
2. **Faster tool registration** - No `jsonschema.ForType()` calls
3. **Faster validation** - Pre-resolved schemas skip resolution step
4. **Type safety** - Generated code is type-checked at compile time

## Integration with MCP SDK

Types with generated `SchemaProvider` implementations automatically benefit from the SDK's schema caching:

```go
// The SDK detects the SchemaProvider interface and uses the pre-computed schema
mcp.AddTool(server, &mcp.Tool{Name: "create_issue"}, createIssueHandler)
```

No additional code changes are needed - the SDK automatically uses the generated schema when available.
