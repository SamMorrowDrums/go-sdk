# mcpgen - MCP Schema Generator

`mcpgen` generates `SchemaProvider` implementations for Go types, enabling zero-reflection schema generation at runtime.

## Installation

```bash
go install github.com/modelcontextprotocol/go-sdk/cmd/mcpgen@latest
```

## Usage

Add a `go:generate` directive to your code:

```go
//go:generate mcpgen -type=CreateIssueInput,UpdateIssueInput
```

Then run:

```bash
go generate ./...
```

This generates a `*_mcp_gen.go` file with `SchemaProvider` implementations for the specified types.

## Example

**Input:**

```go
// types.go
package mypackage

//go:generate mcpgen -type=CreateIssueInput

type CreateIssueInput struct {
    Title  string   `json:"title" jsonschema:"required,description=Issue title"`
    Body   string   `json:"body" jsonschema:"description=Issue body"`
    Labels []string `json:"labels"`
}
```

**Generated output:**

```go
// mypackage_mcp_gen.go
// Code generated by mcpgen. DO NOT EDIT.

package mypackage

import (
    "github.com/google/jsonschema-go/jsonschema"
)

var (
    _createissueinputSchema = &jsonschema.Schema{
        Type: "object",
        Properties: map[string]*jsonschema.Schema{
            "title": {
                Type:        "string",
                Description: "Issue title",
            },
            "body": {
                Type:        "string",
                Description: "Issue body",
            },
            "labels": {
                Type: "array",
            },
        },
        Required:             []string{"title"},
        AdditionalProperties: &jsonschema.Schema{Not: &jsonschema.Schema{}},
    }
    _createissueinputResolved, _ = _createissueinputSchema.Resolve(nil)
)

func (CreateIssueInput) MCPSchema() *jsonschema.Schema {
    return _createissueinputSchema
}

func (CreateIssueInput) MCPResolvedSchema() *jsonschema.Resolved {
    return _createissueinputResolved
}
```

## Struct Tags

`mcpgen` recognizes the following struct tags:

### `json` tag

- `json:"fieldname"` - Sets the JSON property name
- `json:"-"` - Excludes the field from the schema

### `jsonschema` tag

- `required` - Marks the field as required
- `description=text` - Sets the field description
- `default=value` - Sets the default value
- `enum=a|b|c` - Sets allowed enum values (pipe-separated)

## Enum Support

`mcpgen` provides two ways to define enums:

### 1. Automatic Detection from Go Constants (Recommended)

Define a named string type with const declarations, and `mcpgen` will automatically detect the enum values:

```go
// Define the enum type and its values
type Priority string

const (
    PriorityHigh   Priority = "high"
    PriorityMedium Priority = "medium"
    PriorityLow    Priority = "low"
)

// Use it in your input struct
type TaskInput struct {
    Title    string   `json:"title" jsonschema:"required"`
    Priority Priority `json:"priority" jsonschema:"description=Task priority level"`
}
```

**Generated schema:**

```go
"priority": {
    Type:        "string",
    Description: "Task priority level",
    Enum:        []any{"high", "low", "medium"},
},
```

This approach:
- Uses idiomatic Go patterns
- Provides compile-time type safety
- Automatically stays in sync with your Go code
- Works with any named string type that has 2+ const values

### 2. Explicit Tag-Based Enums

For simple cases or when you can't define a separate type, use the `enum` tag:

```go
type UpdateIssueInput struct {
    ID    int    `json:"id" jsonschema:"required"`
    State string `json:"state" jsonschema:"enum=open|closed"`
}
```

**Generated schema:**

```go
"state": {
    Type: "string",
    Enum: []any{"open", "closed"},
},
```

### Enum Best Practices

1. **Prefer const-based enums** for better type safety and IDE support
2. **Use explicit tags** when the enum is only used in one place
3. **Explicit tags take precedence** over auto-detection if both are present
4. **Keep enum values lowercase** for consistency with JSON conventions

## Flags

- `-type` - Comma-separated list of type names to generate (required)
- `-output` - Output file name (default: `<package>_mcp_gen.go`)

## Benefits

Using generated schemas provides:

1. **Zero runtime reflection** - Schemas are pre-computed at build time
2. **Faster tool registration** - No `jsonschema.ForType()` calls
3. **Faster validation** - Pre-resolved schemas skip resolution step
4. **Type safety** - Generated code is type-checked at compile time

## Integration with MCP SDK

Types with generated `SchemaProvider` implementations automatically benefit from the SDK's schema caching:

```go
// The SDK detects the SchemaProvider interface and uses the pre-computed schema
mcp.AddTool(server, &mcp.Tool{Name: "create_issue"}, createIssueHandler)
```

No additional code changes are needed - the SDK automatically uses the generated schema when available.
